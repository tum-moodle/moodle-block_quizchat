define("block_quizchat/instructor",["exports","core/ajax","jquery","block_quizchat/master","block_quizchat/chars_limit","./master"],(function(_exports,_ajax,_jquery,_master,_chars_limit,_master2){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.update_user_select_status_indicators=_exports.sidemenu_gconv_link_clicked=_exports.sidemenu_conv_link_clicked=_exports.newmsgs_count_notf=_exports.is_teacher=_exports.init_instructor=_exports.btn_msg_me_click=_exports.btn_msg_grp_click=_exports.autofill_users_select=_exports.allmsgs_link_clicked=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};let quizchatobj;var msglen,requiredmsg,groups,textinputcontrolname="#block_quizchat_input_instructor_send",groupid=0;let timeoutid,timeoutid_private_group_btns,htmlContent_participants,htmlContent_questions,htmlContent_q_select,htmlContent_p_select,noparticipant_flag=!1,li_clicked=!1,grp_img_white=M.util.image_url("g/g1","core"),grp_img_white_grey=M.cfg.wwwroot+"/blocks/quizchat/img/g1_white_grey.png";var is_teacher=!1;_exports.is_teacher=is_teacher;const send_msg=submit_event=>{let receiverid,questionid,grps_ar;if(submit_event.preventDefault(),(0,_chars_limit.handleWhiteSpaceMsg)(textinputcontrolname)){let msg_text_input=document.querySelector(textinputcontrolname);return(0,_chars_limit.resetCharsCount)(msglen),msg_text_input.setCustomValidity(requiredmsg),msg_text_input.reportValidity(),-1}if(!_master2.full_screen_flag||_master2.full_screen_flag&&!(0,_jquery.default)("#fitem_id_block_quizchat_questions_select").is(":hidden")&&!(0,_jquery.default)("#fitem_id_block_quizchat_users_select").is(":hidden")){if(0===(0,_jquery.default)('#fitem_id_block_quizchat_users_select .form-autocomplete-selection [role="option"]').length)return(0,_jquery.default)("#fitem_id_block_quizchat_users_select label").css({color:"#f00","font-weight":"600"}),0===(0,_jquery.default)('#fitem_id_block_quizchat_questions_select .form-autocomplete-selection [role="option"]').length?(0,_jquery.default)("#fitem_id_block_quizchat_questions_select label").css({color:"#f00","font-weight":"600"}):(0,_jquery.default)("#fitem_id_block_quizchat_questions_select label").css({color:"#000","font-weight":"normal"}),-1;if(receiverid=(0,_jquery.default)('#fitem_id_block_quizchat_users_select span[role="option"]')[0].dataset.value,parseInt(receiverid)==_master.quizchat_address_question_group&&(receiverid=0),0===(0,_jquery.default)('#fitem_id_block_quizchat_questions_select .form-autocomplete-selection [role="option"]').length)return(0,_jquery.default)("#fitem_id_block_quizchat_questions_select label").css({color:"#f00","font-weight":"600"}),-1;(0,_jquery.default)("#questions_required").css("display","none"),questionid=(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]')[0].dataset.value,grps_ar=Object.keys(groups).map((key=>({...groups[key]}))),groupid=parseInt(receiverid)==_master.quizchat_address_everyone?parseInt((0,_jquery.default)('#fitem_id_block_quizchat_users_select span[role="option"]')[0].dataset.value)==_master.quizchat_address_question_group&&parseInt(questionid)!=_master.quizchat_general_question_id?0:parseInt(grps_ar.find((obj=>"all"===obj.name)).id):0,(0,_jquery.default)("#id_block_quizchat_users_select_label").css({color:"#000","font-weight":"normal"}),(0,_jquery.default)('#fitem_id_block_quizchat_users_select input[type="text"]').css({color:"#000","font-weight":"normal"}),(0,_jquery.default)("#block_quizchat_input_instructor_send").prop("disabled",!0),(0,_jquery.default)("#block_quizchat_button_instructor_send").prop("disabled",!0)}else if(_master2.full_screen_flag&&(0,_jquery.default)("#fitem_id_block_quizchat_questions_select").is(":hidden")&&(0,_jquery.default)("#fitem_id_block_quizchat_users_select").is(":hidden")){receiverid=0,questionid=(0,_jquery.default)("#conv-header").data("group-id");let grps_ar=Object.keys(groups).map((key=>({...groups[key]})));parseInt(questionid)==_master.quizchat_address_everyone?(groupid=parseInt(grps_ar.find((obj=>"all"===obj.name)).id),questionid=0):(questionid=(0,_jquery.default)("#conv-header").data("group-id"),groupid=0),(0,_jquery.default)("#id_block_quizchat_users_select_label").css({color:"#000","font-weight":"normal"}),(0,_jquery.default)('#fitem_id_block_quizchat_users_select input[type="text"]').css({color:"#000","font-weight":"normal"}),(0,_jquery.default)("#block_quizchat_input_instructor_send").prop("disabled",!0),(0,_jquery.default)("#block_quizchat_button_instructor_send").prop("disabled",!0)}else if(_master2.full_screen_flag&&!(0,_jquery.default)("#fitem_id_block_quizchat_questions_select").is(":hidden")){if(0===(0,_jquery.default)('#fitem_id_block_quizchat_questions_select .form-autocomplete-selection [role="option"]').length)return(0,_jquery.default)("#fitem_id_block_quizchat_questions_select label").css({color:"#f00","font-weight":"600"}),-1;(0,_jquery.default)("#fitem_id_block_quizchat_questions_select label").css({color:"#000","font-weight":"normal"}),(0,_jquery.default)("#questions_required").css("display","none"),receiverid=(0,_jquery.default)("#conv-header").data("user-id"),questionid=(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]')[0].dataset.value,groupid=0,(0,_jquery.default)("#id_block_quizchat_users_select_label").css({color:"#000","font-weight":"normal"}),(0,_jquery.default)('#fitem_id_block_quizchat_users_select input[type="text"]').css({color:"#000","font-weight":"normal"}),(0,_jquery.default)("#block_quizchat_input_instructor_send").prop("disabled",!0),(0,_jquery.default)("#block_quizchat_button_instructor_send").prop("disabled",!0)}(0,_chars_limit.resetCharsCount)(msglen);const calls=[{methodname:"block_quizchat_create_message",args:{quizchatid:quizchatobj.id,receiverid:parseInt(receiverid),groupid:groupid,message:(0,_jquery.default)("#block_quizchat_input_instructor_send").val(),questionattemptid:0,questionid:parseInt(questionid)}}];(0,_ajax.call)(calls)[0].then((data=>((0,_master.reset_poll_timeout)(),(0,_jquery.default)("#block_quizchat_input_instructor_send").val(""),resetMenus(),(0,_jquery.default)("#block_quizchat_input_instructor_send").prop("disabled",!1),(0,_jquery.default)("#block_quizchat_button_instructor_send").prop("disabled",!1),(0,_jquery.default)("#block_quizchat_input_instructor_send").trigger("focus"),data.id))).catch((()=>{(0,_jquery.default)("#block_quizchat_input_instructor_send").prop("disabled",!1),(0,_jquery.default)("#block_quizchat_button_instructor_send").prop("disabled",!1)}))},text_oninput=oninput_event=>{oninput_event.preventDefault(),(0,_chars_limit.checkCharsLength)(msglen,textinputcontrolname),oninput_event.target.setCustomValidity("")},text_onblur=onblur_event=>{onblur_event.preventDefault(),(0,_chars_limit.handleWhiteSpaceMsg)(textinputcontrolname)&&(0,_chars_limit.resetCharsCount)(msglen),onblur_event.target.setCustomValidity("")},get_user_state=userid=>_master.quizchat_users.find((u=>u.id===userid)).state;_exports.autofill_users_select=event=>{event.preventDefault();const[userid,questionid,questiontxt]=event.target.getAttribute("href").slice(1).split("/");if((0,_jquery.default)("#fitem_id_block_quizchat_users_select").is(":hidden")||(0,_jquery.default)("#fitem_id_block_quizchat_questions_select").is(":hidden")){let traget_conv_id="side-menu-conv-link-user-"+userid,target_conv_el=(0,_jquery.default)("#"+traget_conv_id);if(void 0!==target_conv_el.html())target_conv_el.trigger("click"),resetMenus(),resetMenus_click_respond(userid,questionid,questiontxt),update_user_select_status_indicators(),event.target.blur();else{(0,_master.write_sessionStorage)("selected_user_or_question_id",userid),(0,_master.write_sessionStorage)("grp_flag",!1),update_conversation_header(userid,!1),(0,_jquery.default)("#block_quizchat_messages > .block_quizchat_msg_area_body").empty(),resetMenus(),resetMenus_click_respond(userid,questionid,questiontxt),toggle_autocomplete(!0,(0,_jquery.default)("#fitem_id_block_quizchat_questions_select")),toggle_autocomplete(!1,(0,_jquery.default)("#fitem_id_block_quizchat_users_select")),(0,_master.write_sessionStorage)("total_unread_msg_usr_qs",0);let filteredMessages=[];(0,_master.update_current_msgs_array)(filteredMessages);let key="newmsgscount_userid_"+userid;(0,_master.write_sessionStorage)("latest_msg_id_usr_qs",0),(0,_master.write_sessionStorage)(key,"0"),update_user_select_status_indicators(),event.target.blur()}}else(0,_jquery.default)("#id_block_quizchat_enableflag").attr("value",0),resetMenus_click_respond(userid,questionid,questiontxt),update_user_select_status_indicators(),event.target.blur()};const update_user_select_status_indicators=()=>{(0,_jquery.default)('#block_quizchat_instructor_form ul.form-autocomplete-suggestions li[role="option"]').each((function(i,el){let userid=parseInt(el.getAttribute("data-value"));if(isNaN(userid))return;let userstate=get_user_state(userid),status_indicator_el=(0,_jquery.default)("div.statecircle-base-menu",(0,_jquery.default)(el));status_indicator_el.removeClass(),status_indicator_el.addClass("statecircle-base-menu "+userstate),status_indicator_el.attr("title",_master.lang_strings[userstate])}));let chosen_option_span=(0,_jquery.default)('#block_quizchat_instructor_form span[role="option"]');if(0>=chosen_option_span.length)return;let chosen_userid=parseInt(chosen_option_span.attr("data-value")),chosen_user_state=get_user_state(chosen_userid),chosen_status_indicator=(0,_jquery.default)("div.statecircle-base-menu",chosen_option_span);chosen_status_indicator.removeClass(),chosen_status_indicator.addClass("statecircle-base-menu "+chosen_user_state),chosen_status_indicator.attr("title",_master.lang_strings[chosen_user_state])};_exports.update_user_select_status_indicators=update_user_select_status_indicators;const text_setvalidmsg=e=>{e.target.setCustomValidity(requiredmsg)},users_select_change=()=>{0==(0,_jquery.default)("#id_block_quizchat_enableflag").attr("value")&&(0,_jquery.default)("#id_block_quizchat_enableflag").attr("value",1)},questions_select_change=()=>{let enableflag=(0,_jquery.default)("#id_block_quizchat_enableflag").attr("value");if((!(0,_jquery.default)("#fitem_id_block_quizchat_users_select").is(":hidden")&&_master2.full_screen_flag||!_master2.full_screen_flag)&&1==enableflag){(0,_jquery.default)("#id_block_quizchat_questions_select_label").css({color:"#000","font-weight":"normal"});let questionid,participantid,group_string=_master.lang_strings.group_txt,selected_question=document.querySelector('#fitem_id_block_quizchat_questions_select span[role="option"]'),selected_participant=document.querySelector('#fitem_id_block_quizchat_users_select span[role="option"]');if(selected_question)if(questionid=(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]')[0].dataset.value,selected_participant)if(participantid=(0,_jquery.default)('#fitem_id_block_quizchat_users_select span[role="option"]')[0].dataset.value,questionid==String(_master.quizchat_general_question_id))participantid!=String(_master.quizchat_address_everyone)&&((0,_jquery.default)('#block_quizchat_instructor_form span[aria-hidden="true"]:contains("× ")').trigger("click"),(0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").trigger("click"),observeForElement("#block_quizchat_instructor_form li"));else{let gname=(0,_jquery.default)('#block_quizchat_questions_form span[role="option"] div.divcontainer-questions').attr("title"),selected_participant_name=(0,_jquery.default)("#block_quizchat_instructor_form div.participant-name-menu").attr("title"),allgrouptxt=group_string+" "+gname;(participantid!=_master.quizchat_address_question_group||selected_participant_name!=allgrouptxt)&&((0,_jquery.default)('#block_quizchat_instructor_form span[aria-hidden="true"]:contains("× ")').trigger("click"),(0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").trigger("click"),observeForElement("#block_quizchat_instructor_form li"))}else String(_master.quizchat_general_question_id),(0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").trigger("click"),observeForElement("#block_quizchat_instructor_form li");else selected_participant&&(0,_jquery.default)('#block_quizchat_instructor_form span[aria-hidden="true"]:contains("× ")').trigger("click")}},observeForElement=elementSelector=>{new MutationObserver(((mutationsList,observer)=>{for(const mutation of mutationsList)if("childList"===mutation.type){if(document.querySelector(elementSelector)){if(elementSelector.includes("block_quizchat_instructor_form")&&noparticipant_flag&&users_select_change(),!elementSelector.includes("li")){(0,_jquery.default)(elementSelector).trigger("click"),observer.disconnect();break}if("none"!==(0,_jquery.default)(elementSelector).closest("ul").css("display")){(0,_jquery.default)(elementSelector.includes("block_quizchat_instructor_form li[data-value"))&&(li_clicked=!0),(0,_jquery.default)(elementSelector).first().attr("aria-selected","true"),(0,_jquery.default)(elementSelector).first().trigger("click"),observer.disconnect();break}}}})).observe(document.body,{childList:!0,subtree:!0})},add_divcontainer_after_question_select=()=>{document.querySelector('#fitem_id_block_quizchat_questions_select span[role="option"][data-value="'+_master.quizchat_general_question_id+'"]')?add_divcontainerquestions():setTimeout((()=>{add_divcontainer_after_question_select()}),150)},setFormsIfExist=()=>{let q_form=document.querySelector("#block_quizchat_questions_form ul.form-autocomplete-suggestions"),p_form=document.querySelector("#block_quizchat_instructor_form ul.form-autocomplete-suggestions");q_form&&p_form?(setMenus(),clearTimeout(timeoutid)):timeoutid=setTimeout(setFormsIfExist,1e3)},click_private_group_btns=()=>{_master.quizchat_msg.messages.length>0?((0,_jquery.default)("#allmsgs_link").trigger("click"),(0,_jquery.default)("#btn_msg_me").trigger("click"),(0,_jquery.default)("#btn_msg_all").trigger("click"),clearTimeout(timeoutid_private_group_btns)):((0,_jquery.default)(".header-container").html().trim()||update_conversation_header(_master.allmsgs_id,!1),timeoutid_private_group_btns=setTimeout(click_private_group_btns,1e3))},resetMenus=()=>{(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').each((function(){(0,_jquery.default)(this).find(".divcontainer-questions").replaceWith(htmlContent_questions)})),(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').attr("data-value",_master.quizchat_general_question_id),(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').parent().attr("data-active-value",_master.quizchat_general_question_id),(0,_jquery.default)('#block_quizchat_instructor_form span[role="option"]').each((function(){(0,_jquery.default)(this).find(".statecircle-base-menu").length>0&&(0,_jquery.default)(this).find(".statecircle-base-menu").remove(),(0,_jquery.default)(this).find(".divcontainer").replaceWith(htmlContent_participants)})),(0,_jquery.default)('#block_quizchat_instructor_form span[role="option"]').attr("data-value",_master.quizchat_address_everyone),(0,_jquery.default)('#block_quizchat_instructor_form span[role="option"]').parent().attr("data-active-value",_master.quizchat_address_everyone),(0,_jquery.default)("#id_block_quizchat_questions_select").empty(),(0,_jquery.default)("#id_block_quizchat_questions_select").append(htmlContent_q_select),(0,_jquery.default)("#id_block_quizchat_users_select").empty(),(0,_jquery.default)("#id_block_quizchat_users_select").append(htmlContent_p_select)},resetMenus_click_respond=(pid,qid,qtxt)=>{let questionid,participantid,selected_question=document.querySelector('#fitem_id_block_quizchat_questions_select span[role="option"]'),selected_participant=document.querySelector('#fitem_id_block_quizchat_users_select span[role="option"]');selected_question?(questionid=(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]')[0].dataset.value,selected_participant?(participantid=(0,_jquery.default)('#fitem_id_block_quizchat_users_select span[role="option"]')[0].dataset.value,questionid==String(qid)?participantid!=String(pid)&&((0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").trigger("click"),observeForElement('#block_quizchat_instructor_form li[data-value="'+pid+'"]')):(click_to_respond(qid,qtxt),noparticipant_flag=!0,(0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").trigger("click"),observeForElement('#block_quizchat_instructor_form li[data-value="'+pid+'"]'))):questionid==String(qid)?((0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").trigger("click"),observeForElement('#block_quizchat_instructor_form li[data-value="'+pid+'"]')):(click_to_respond(qid,qtxt),(0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").trigger("click"),observeForElement('#block_quizchat_instructor_form li[data-value="'+pid+'"]'))):(selected_participant&&(0,_jquery.default)('#block_quizchat_instructor_form span[aria-hidden="true"]:contains("× ")').trigger("click"),click_to_respond(qid,qtxt),waitForElement('#fitem_id_block_quizchat_questions_select span[role="option"]',(()=>{observeSelectedQuestion(qid,pid)}))),qid==_master.quizchat_address_everyone&&(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]').attr("data-value")!=qid&&add_divcontainer_after_question_select(),noparticipant_flag=!1},waitForElement=(selector,callback)=>{if(document.querySelector(selector))callback();else{const observer=new MutationObserver((()=>{document.querySelector(selector)&&(observer.disconnect(),callback())}));observer.observe(document.body,{childList:!0,subtree:!0})}},observeSelectedQuestion=(qid,pid)=>{(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]')[0].dataset.value===qid&&((0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").trigger("click"),observeForElement('#block_quizchat_instructor_form li[data-value="'+pid+'"]'))},add_divcontainerquestions=()=>{(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]').find(".divcontainer-questions").length>0||(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]').attr("data-value")!=_master.quizchat_general_question_id||(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').each((function(){(0,_jquery.default)(this).contents().last().replaceWith(htmlContent_questions)}))},click_to_respond=(questionid,questiontxt)=>{let select_list_q=(0,_jquery.default)("#block_quizchat_questions_form ul.form-autocomplete-suggestions"),existing_list_item_q=(0,_jquery.default)('li[role="option"][data-value="'+questionid+'"]',select_list_q),listitem_q='<li role="option" data-value="'+questionid+'"></li>',menu_select_q=(0,_jquery.default)("#id_block_quizchat_questions_select"),existing_option_q=(0,_jquery.default)('option[value="'+questionid+'"',menu_select_q),option_q='<option value="'+questionid+'"></option>',divcontainer_q=(0,_jquery.default)('<div class="divcontainer-questions"></div>');click_to_respond_process(select_list_q,existing_list_item_q,listitem_q,menu_select_q,existing_option_q,option_q,divcontainer_q,'<div class="questions-menu" title="'+questiontxt+'">'+questiontxt+"</div>",'#block_quizchat_questions_form ul.form-autocomplete-suggestions li[role="option"][data-value="'+questionid+'"]')},click_to_respond_process=(select_list,existing_list_item,listitem,menu_select,existing_option,option,divcontainer,childdiv,li_to_click)=>{divcontainer.append(childdiv),0===existing_list_item.length&&select_list.append((0,_jquery.default)(listitem).append(divcontainer)),0===existing_option.length&&menu_select.append((0,_jquery.default)(option).append(divcontainer)),(0,_jquery.default)(li_to_click).trigger("click")},setMenus=()=>{htmlContent_participants='<div title="'+_master.lang_strings.everyone+'" class="divcontainer"><div class="participant-name-menu" title="'+_master.lang_strings.everyone+'">'+_master.lang_strings.everyone+"</div></div>",htmlContent_questions='<div title="'+_master.lang_strings.student_question_general+'" class="divcontainer-questions"><div class="questions-menu" title="'+_master.lang_strings.student_question_general+'">'+_master.lang_strings.student_question_general+"</div></div>",htmlContent_q_select=(0,_jquery.default)("#id_block_quizchat_questions_select").children().clone(),htmlContent_p_select=(0,_jquery.default)("#id_block_quizchat_users_select").children().clone(),add_divcontainerquestions(),(0,_jquery.default)('#block_quizchat_instructor_form span[role="option"]').each((function(){(0,_jquery.default)(this).contents().last().replaceWith(htmlContent_participants)})),(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').attr("data-value",_master.quizchat_general_question_id),(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').parent().attr("data-active-value",_master.quizchat_general_question_id),(0,_jquery.default)('#block_quizchat_instructor_form span[role="option"]').attr("data-value",_master.quizchat_address_everyone),(0,_jquery.default)('#block_quizchat_instructor_form span[role="option"]').parent().attr("data-active-value",_master.quizchat_address_everyone)},help_click=()=>{toggle_help_deactivated_students_msgs_help()},toggle_help_deactivated_students_msgs_help=()=>{let help_el=document.getElementById("help_deactivated_students_msgs_help"),help_icon=document.getElementById("permissions_help_icon"),close_icon=document.getElementById("close_help_icon");"none"==help_el.style.display?(help_el.style.display="flex",help_icon.style.display="none",close_icon.style.display="inline"):(help_el.style.display="none",help_icon.style.display="inline",close_icon.style.display="none")},fullscreen_click=event=>{event.preventDefault();let hrefValue=(0,_jquery.default)(".fullscreen_actionmenu_item").attr("href");window.open(hrefValue,"_blank","toolbar=yes,scrollbars=yes,resizable=yes")},ul_callback=mutations=>{for(var mutation of mutations)if("childList"===mutation.type){let attr=(0,_jquery.default)("#block_quizchat_questions_form ul.form-autocomplete-suggestions").attr("aria-hidden");if(void 0===attr||0==attr){let chosen_option_span=(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]');if(chosen_option_span.length>0){let active_li=(0,_jquery.default)('#block_quizchat_questions_form ul li[aria-selected="true"]');(0,_jquery.default)(active_li).length>0&&parseInt((0,_jquery.default)(active_li).attr("data-value"))!==parseInt((0,_jquery.default)(chosen_option_span).attr("data-value"))&&(0,_jquery.default)('#block_quizchat_questions_form ul.form-autocomplete-suggestions li[aria-selected="true"]').attr("aria-selected","false")}}}},ul_callback_p=mutations=>{for(var mutation of mutations)if("childList"===mutation.type){let attr=(0,_jquery.default)("#block_quizchat_instructor_form ul.form-autocomplete-suggestions").attr("aria-hidden");if(void 0===attr||0==attr){let chosen_option_span=(0,_jquery.default)('#block_quizchat_instructor_form span[role="option"]');if(chosen_option_span.length>0){let active_li=(0,_jquery.default)('#block_quizchat_instructor_form ul li[aria-selected="true"]');(0,_jquery.default)(active_li).length>0&&parseInt((0,_jquery.default)(active_li).attr("data-value"))!==parseInt((0,_jquery.default)(chosen_option_span).attr("data-value"))&&(li_clicked?li_clicked=!1:(0,_jquery.default)('#block_quizchat_instructor_form ul.form-autocomplete-suggestions li[aria-selected="true"]').attr("aria-selected","false"))}}}},toggle_autocomplete=(enable,parentElement)=>{parentElement.length&&(enable?parentElement.is(":hidden")&&parentElement.attr("style","display:block !important;"):parentElement.is(":hidden")||parentElement.attr("style","display:none !important;"))},sidemenu_conv_link_clicked=event=>{event.preventDefault();const userid=event.target.closest("a").getAttribute("href").substring(1);(0,_master.write_sessionStorage)("selected_user_or_question_id",userid),(0,_master.write_sessionStorage)("grp_flag",!1),update_conversation_header(userid,!1),(0,_jquery.default)("#block_quizchat_messages > .block_quizchat_msg_area_body").empty(),resetMenus(),toggle_autocomplete(!0,(0,_jquery.default)("#fitem_id_block_quizchat_questions_select")),toggle_autocomplete(!1,(0,_jquery.default)("#fitem_id_block_quizchat_users_select")),(0,_master.write_sessionStorage)("total_unread_msg_usr_qs",0);let msg_ids=_master.quizchat_msg.p_users.find((el=>el.userid===parseInt(userid))).message_ids.replace(/\s/g,"").split(",").map((id=>parseInt(id))),filteredMessages=_master.quizchat_msg.messages.filter((msg=>msg_ids.includes(msg.id)));(0,_master.update_current_msgs_array)(filteredMessages);let key="newmsgscount_userid_"+userid,msgs_count=(0,_master2.int_sessionStorage)(key);(0,_master.write_sessionStorage)("latest_msg_id_usr_qs",msg_ids[msg_ids.length-msgs_count-1]),(0,_master.update_msg_area)(filteredMessages.length),(0,_master.write_sessionStorage)("latest_msg_id_usr_qs",msg_ids[msg_ids.length-1]),(0,_master.write_sessionStorage)("newmsgscount_all",(0,_master2.int_sessionStorage)("newmsgscount_all")-(0,_master2.int_sessionStorage)(key)),(0,_master.write_sessionStorage)(key,"0"),newmsgs_count_notf(userid,!1)};_exports.sidemenu_conv_link_clicked=sidemenu_conv_link_clicked;const sidemenu_gconv_link_clicked=event=>{event.preventDefault();const questionid=event.target.closest("a").getAttribute("href").substring(1);(0,_master.write_sessionStorage)("selected_user_or_question_id",questionid),(0,_master.write_sessionStorage)("grp_flag",!0),update_conversation_header(questionid,!0),(0,_jquery.default)("#block_quizchat_messages > .block_quizchat_msg_area_body").empty(),toggle_autocomplete(!1,(0,_jquery.default)("#fitem_id_block_quizchat_questions_select")),toggle_autocomplete(!1,(0,_jquery.default)("#fitem_id_block_quizchat_users_select")),(0,_master.write_sessionStorage)("total_unread_msg_usr_qs",0);let msg_ids=_master.quizchat_msg.groups.find((el=>el.question_id===parseInt(questionid))).message_ids.replace(/\s/g,"").split(",").map((id=>parseInt(id))),filteredMessages=_master.quizchat_msg.messages.filter((msg=>msg_ids.includes(msg.id)));(0,_master.update_current_msgs_array)(filteredMessages);let key="newmsgscount_questionid_"+questionid,msgs_count=(0,_master2.int_sessionStorage)(key);(0,_master.write_sessionStorage)("latest_msg_id_usr_qs",msg_ids[msg_ids.length-msgs_count-1]),(0,_master.update_msg_area)(filteredMessages.length),(0,_master.write_sessionStorage)("latest_msg_id_usr_qs",msg_ids[msg_ids.length-1]),(0,_master.write_sessionStorage)("newmsgscount_all",(0,_master2.int_sessionStorage)("newmsgscount_all")-(0,_master2.int_sessionStorage)(key)),(0,_master.write_sessionStorage)(key,"0"),newmsgs_count_notf(questionid,!0)};_exports.sidemenu_gconv_link_clicked=sidemenu_gconv_link_clicked;const allmsgs_link_clicked=event=>{event.preventDefault(),update_conversation_header(_master.allmsgs_id,!1),(0,_jquery.default)("#block_quizchat_messages > .block_quizchat_msg_area_body").empty(),resetMenus(),toggle_autocomplete(!0,(0,_jquery.default)("#fitem_id_block_quizchat_questions_select")),toggle_autocomplete(!0,(0,_jquery.default)("#fitem_id_block_quizchat_users_select")),(0,_master.write_sessionStorage)("selected_user_or_question_id",_master.allmsgs_id),(0,_master.write_sessionStorage)("grp_flag",!1),(0,_master.update_current_msgs_array)(_master.quizchat_msg.messages);let msgs=_master.quizchat_msg.messages;(0,_master.update_msg_area)(msgs.length),Object.keys(sessionStorage).forEach((key=>{key.includes("newmsgscount_")&&sessionStorage.setItem(key,"0")})),(0,_jquery.default)('span[id*="unread-count-question-"], span[id*="unread-count-user-"]').each((function(){let parts=(0,_jquery.default)(this).attr("id").split("-"),second_last_part=parts[parts.length-2],question_or_user_id=parseInt(parts[parts.length-1]);newmsgs_count_notf(question_or_user_id,"question"===second_last_part)}))};_exports.allmsgs_link_clicked=allmsgs_link_clicked;const newmsgs_count_notf=(question_or_user_id,is_questionid)=>{let header_question_or_user_id,span_id="#unread-count-"+(is_questionid?"question":"user")+"-"+String(question_or_user_id),key="newmsgscount_"+(is_questionid?"questionid":"userid")+"_"+String(question_or_user_id),msgs_count=(0,_master2.int_sessionStorage)(key),header_is_allmsgs=!1;if(void 0!==(0,_jquery.default)("#conv-header").data("group-id")?(header_question_or_user_id=parseInt((0,_jquery.default)("#conv-header").data("group-id")),header_question_or_user_id==_master.allmsgs_id&&(header_is_allmsgs=!0)):void 0!==(0,_jquery.default)("#conv-header").data("user-id")&&(header_question_or_user_id=parseInt((0,_jquery.default)("#conv-header").data("user-id"))),msgs_count>0){let key_all="newmsgscount_all",session_msgs_count_all=0;parseInt((0,_jquery.default)(span_id).html())!==msgs_count&&((0,_jquery.default)(span_id).html(String(msgs_count)),(0,_jquery.default)(span_id).attr("aria-hidden","false"),(0,_jquery.default)(span_id).parent("span").removeClass("hidden")),Object.keys(sessionStorage).forEach((sessionkey=>{(sessionkey.includes("newmsgscount_questionid_")||sessionkey.includes("newmsgscount_userid_"))&&(session_msgs_count_all+=parseInt(sessionStorage.getItem(sessionkey)))})),(0,_master.write_sessionStorage)(key_all,String(session_msgs_count_all)),(0,_master.allmsgs_count_notf)(),header_is_allmsgs?Object.keys(sessionStorage).forEach((sessionkey=>{sessionkey.includes("newmsgscount_")&&sessionStorage.setItem(sessionkey,"0")})):(header_question_or_user_id==question_or_user_id&&(0,_master.write_sessionStorage)(key,"0"),session_msgs_count_all=0,Object.keys(sessionStorage).forEach((sessionkey=>{(sessionkey.includes("newmsgscount_questionid_")||sessionkey.includes("newmsgscount_userid_"))&&(session_msgs_count_all+=parseInt(sessionStorage.getItem(sessionkey)))})),(0,_master.write_sessionStorage)(key_all,String(session_msgs_count_all)))}else(0,_jquery.default)(span_id).attr("aria-hidden","true"),(0,_jquery.default)(span_id).parent("span").addClass("hidden"),(0,_jquery.default)(span_id).html("")};_exports.newmsgs_count_notf=newmsgs_count_notf;const update_conversation_header=(id,groupFlag)=>{(0,_jquery.default)(".header-container").empty();let ar=id==_master.allmsgs_id?[]:groupFlag?_master.quizchat_msg.groups:_master.quizchat_msg.p_users,element=id==_master.allmsgs_id?[]:ar.find((el=>groupFlag?el.question_id===parseInt(id):el.userid===parseInt(id)));void 0===element&&(element=_master.quizchat_users.find((u=>u.id===parseInt(id))),element.picture=element.profileimageurlsmall,element.userid=element.id);let conv_header=(0,_jquery.default)('<div class="bg-white position-relative border-bottom p-1 px-sm-2" data-region="view-conversation" data-from-panel="true"><div class="" data-region="header-content"><div class="d-flex align-items-center"><div class="d-flex text-truncate"><div class="d-flex align-items-center"><img class="rounded-circle" src="'+(id==_master.allmsgs_id?grp_img_white_grey:groupFlag?element.question_id==_master.quizchat_address_everyone?grp_img_white_grey:grp_img_white:element.picture)+'" alt="'+(id==_master.allmsgs_id?"All messages":groupFlag?element.group_name:element.fullname)+'" aria-hidden="true" style="height: 38px"><span id="conv-header" class="contact-status-header icon-size-2 " '+(id==_master.allmsgs_id?'data-group-id="'+_master.allmsgs_id:groupFlag?'data-group-id="'+element.question_id:'data-user-id="'+element.userid)+'">'+(groupFlag||id==_master.allmsgs_id?" ":'<div id="header-state" class="statecircle-base '+element.state+'" data-user-id="'+element.userid+'" title="'+_master.lang_strings[element.state]+'"></div>')+'</span></div><div class="w-100 text-truncate qc-ml-2"><div class="d-flex"><strong class="m-0 text-truncate">'+(id==_master.allmsgs_id?"All messages":groupFlag?element.group_name:element.fullname)+'</strong></div><p id="written-header-state" class="m-0 qc-font-weight-light text-truncate">'+(id==_master.allmsgs_id||groupFlag?" ":_master.lang_strings[element.state])+"</p></div></div></div></div></div>");(0,_jquery.default)(".header-container").append(conv_header)},btn_msg_me_click=()=>{if(void 0!==_master.quizchat_msg.p_users){let new_msgs_count,msgs_count,key;(0,_jquery.default)("#conversations_container_private").empty();let msgs=_master.quizchat_msg;void 0!==_master.quizchat_msg_counters&&(msgs=_master.quizchat_msg_counters),msgs.p_users.forEach((user=>{new_msgs_count=void 0===user.new_msgs_count?0:user.new_msgs_count,key="newmsgscount_userid_"+String(user.userid),msgs_count=sessionStorage.getItem("moodle_qc_"+_master.quizchat_userid+"_"+_master.quizchatid+"_"+key),null===msgs_count?((0,_master.write_sessionStorage)(key,String(new_msgs_count)),msgs_count=new_msgs_count):(msgs_count=(0,_master2.int_sessionStorage)(key)+new_msgs_count,(0,_master.write_sessionStorage)(key,String(msgs_count)));let messageIdsArray=user.message_ids.split(", "),lastMessageId=messageIdsArray[messageIdsArray.length-1],user_last_msg=_master.quizchat_msg.messages.filter((msg=>msg.id==lastMessageId)),msg_time=new Date(1e3*user_last_msg[0].timestamp),displayDate=(0,_master.isToday)(user_last_msg[0].timestamp)?msg_time.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):msg_time.toLocaleDateString("en-GB"),conv_link=(0,_jquery.default)('<a href="#'+user.userid+'" class="py-0 px-2 d-flex list-group-item list-group-item-action align-items-center" data-conversation-id="-" data-user-id="'+user.userid+'" role="button" id="side-menu-conv-link-user-'+String(user.userid)+'"><img class="rounded-circle align-self-start mt-2" src="'+user.picture+'" title="'+user.fullname+'" alt="'+user.fullname+'" aria-hidden="true" style="height: 38px"><span class="contact-status-sidemenu icon-size-2 " data-user-id="'+user.userid+'"><div class="statecircle-base '+user.state+'" title="'+_master.lang_strings[user.state]+'"></div></span><div class="w-100 text-truncate qc-ml-2 my-2"><div class="d-flex"><strong class="m-0 text-truncate">'+user.fullname+'</strong><span class="hidden" data-region="contact-icon-blocked"><i class="icon fa fa-ban fa-fw " title="Contact blocked" role="img" aria-label="Contact blocked"></i></span><span class="hidden" data-region="muted-icon-container"><i class="icon fa fa-microphone-slash fa-fw " aria-hidden="true"></i></span></div><p class="m-0 qc-font-weight-light text-truncate last-message" data-region="last-message">'+(user_last_msg[0].userid==_master.quizchat_userid?_master.lang_strings.sidemenu_you+": <span>"+user_last_msg[0].message+"</span>":"<span>"+user_last_msg[0].message+"</span>")+'</p></div><div class="d-flex align-self-stretch"><div class="px-2 py-1 small position-absolute position-right " data-region="last-message-date" aria-hidden="true">'+displayDate+'</div><div class="d-flex align-self-center align-items-center"><span class="badge rounded-pill bg-primary text-white '+(msgs_count>0?"":"hidden")+'" data-region="unread-count"><span id="unread-count-user-'+user.userid+'" data-user-id="'+user.userid+'">'+(msgs_count>0?String(msgs_count):"")+'</span></span><div class="text-muted qc-ml-auto"><span class="dir-rtl-hide"><i class="icon fa fa-chevron-right fa-fw " aria-hidden="true"></i></span><span class="dir-ltr-hide"><i class="icon fa fa-chevron-left fa-fw " aria-hidden="true"></i></span></div></div></div></a>');(0,_jquery.default)("#conversations_container_private").append(conv_link),newmsgs_count_notf(user.userid,!1)}));let header_question_or_user_id,header_is_allmsgs=!1;if(void 0!==(0,_jquery.default)("#conv-header").data("group-id")?(header_question_or_user_id=parseInt((0,_jquery.default)("#conv-header").data("group-id")),header_question_or_user_id==_master.allmsgs_id&&(header_is_allmsgs=!0)):void 0!==(0,_jquery.default)("#conv-header").data("user-id")&&(header_question_or_user_id=parseInt((0,_jquery.default)("#conv-header").data("user-id"))),header_is_allmsgs)Object.keys(sessionStorage).forEach((sessionkey=>{sessionkey.includes("newmsgscount_")&&sessionStorage.setItem(sessionkey,"0")}));else{let session_msgs_count_all=0,key_all="newmsgscount_all";Object.keys(sessionStorage).forEach((sessionkey=>{(sessionkey.includes("newmsgscount_questionid_")||sessionkey.includes("newmsgscount_userid_"))&&(session_msgs_count_all+=parseInt(sessionStorage.getItem(sessionkey)))})),(0,_master.write_sessionStorage)(key_all,String(session_msgs_count_all)),(0,_master.allmsgs_count_notf)()}(0,_jquery.default)("#conversations_container_private").off("click","a",sidemenu_conv_link_clicked),(0,_jquery.default)("#conversations_container_private").on("click","a",sidemenu_conv_link_clicked)}};_exports.btn_msg_me_click=btn_msg_me_click;const btn_msg_grp_click=()=>{if(void 0!==_master.quizchat_msg.groups){let new_msgs_count,msgs_count,key;(0,_jquery.default)("#conversations_container_group").empty();let msgs=_master.quizchat_msg;void 0!==_master.quizchat_msg_counters&&(msgs=_master.quizchat_msg_counters),msgs.groups.forEach((group=>{new_msgs_count=void 0===group.new_msgs_count?0:group.new_msgs_count,key="newmsgscount_questionid_"+String(group.question_id),msgs_count=sessionStorage.getItem("moodle_qc_"+_master.quizchat_userid+"_"+_master.quizchatid+"_"+key),null===msgs_count?((0,_master.write_sessionStorage)(key,String(new_msgs_count)),msgs_count=new_msgs_count):(msgs_count=(0,_master2.int_sessionStorage)(key)+new_msgs_count,(0,_master.write_sessionStorage)(key,String(msgs_count)));let messageIdsArray=group.message_ids.split(","),lastMessageId=messageIdsArray[messageIdsArray.length-1],group_last_msg=_master.quizchat_msg.messages.filter((msg=>msg.id==lastMessageId)),msg_time=new Date(1e3*group_last_msg[0].timestamp),displayDate=(0,_master.isToday)(group_last_msg[0].timestamp)?msg_time.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):msg_time.toLocaleDateString("en-GB"),conv_link=(0,_jquery.default)('<a href="#'+group.question_id+'" class="py-0 px-2 d-flex list-group-item list-group-item-action align-items-center" data-conversation-id="-" data-group-id="'+group.question_id+'" role="button" id="side-menu-conv-link-question-'+String(group.question_id)+'"><img class="rounded-circle align-self-start mt-2" src="'+(group.question_id==_master.quizchat_address_everyone?grp_img_white_grey:grp_img_white)+'" title="'+group.group_name+'" alt="'+group.group_name+'" aria-hidden="true" style="height: 38px"><span class="contact-status icon-size-2 "></span><div class="w-100 text-truncate qc-ml-2 my-2"><div class="d-flex"><strong class="m-0 text-truncate">'+group.group_name+'</strong><span class="hidden" data-region="contact-icon-blocked"><i class="icon fa fa-ban fa-fw " title="Contact blocked" role="img" aria-label="Contact blocked"></i></span><span class="hidden" data-region="muted-icon-container"><i class="icon fa fa-microphone-slash fa-fw " aria-hidden="true"></i></span></div><p class="m-0 qc-font-weight-light text-truncate last-message" data-region="last-message">'+(group_last_msg[0].userid==_master.quizchat_userid?_master.lang_strings.sidemenu_you+": <span>"+group_last_msg[0].message+"</span>":"<span>"+group_last_msg[0].message+"</span>")+'</p></div><div class="d-flex align-self-stretch"><div class="px-2 py-1 small position-absolute position-right " data-region="last-message-date" aria-hidden="true">'+displayDate+'</div><div class="d-flex align-self-center align-items-center"><span class="badge rounded-pill bg-primary text-white '+(msgs_count>0?"":"hidden")+'" data-region="unread-count"><span id="unread-count-question-'+group.question_id+'" data-question-id="'+group.question_id+'">'+(msgs_count>0?String(msgs_count):"")+'</span></span><div class="text-muted qc-ml-auto"><span class="dir-rtl-hide"><i class="icon fa fa-chevron-right fa-fw " aria-hidden="true"></i></span><span class="dir-ltr-hide"><i class="icon fa fa-chevron-left fa-fw " aria-hidden="true"></i></span></div></div></div></a>');(0,_jquery.default)("#conversations_container_group").append(conv_link),newmsgs_count_notf(group.question_id,!0)}));let header_question_or_user_id,header_is_allmsgs=!1;if(void 0!==(0,_jquery.default)("#conv-header").data("group-id")?(header_question_or_user_id=parseInt((0,_jquery.default)("#conv-header").data("group-id")),header_question_or_user_id==_master.allmsgs_id&&(header_is_allmsgs=!0)):void 0!==(0,_jquery.default)("#conv-header").data("user-id")&&(header_question_or_user_id=parseInt((0,_jquery.default)("#conv-header").data("user-id"))),header_is_allmsgs)Object.keys(sessionStorage).forEach((sessionkey=>{sessionkey.includes("newmsgscount_")&&sessionStorage.setItem(sessionkey,"0")}));else{let session_msgs_count_all=0,key_all="newmsgscount_all";Object.keys(sessionStorage).forEach((sessionkey=>{(sessionkey.includes("newmsgscount_questionid_")||sessionkey.includes("newmsgscount_userid_"))&&(session_msgs_count_all+=parseInt(sessionStorage.getItem(sessionkey)))})),(0,_master.write_sessionStorage)(key_all,String(session_msgs_count_all)),(0,_master.allmsgs_count_notf)()}(0,_jquery.default)("#conversations_container_group").off("click","a",sidemenu_gconv_link_clicked),(0,_jquery.default)("#conversations_container_group").on("click","a",sidemenu_gconv_link_clicked)}};_exports.btn_msg_grp_click=btn_msg_grp_click;_exports.init_instructor=(arg_quizchat,confingsetting_msglen,reqmsg,receivergroups)=>{_exports.is_teacher=is_teacher=!0,("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["block_quizchat/master"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("block_quizchat/master")):Promise.resolve(_systemImportTransformerGlobalIdentifier["block_quizchat/master"])).then((()=>{quizchatobj=arg_quizchat,msglen=confingsetting_msglen,requiredmsg=reqmsg,groups=receivergroups,(0,_jquery.default)("#id_block_quizchat_users_select").change((()=>{(0,_jquery.default)("#block_quizchat_instructor_form label").css({color:"#000","font-weight":"normal"})})),(0,_jquery.default)("#id_block_quizchat_questions_select").on("change",questions_select_change),(0,_jquery.default)("#id_block_quizchat_users_select").on("change",users_select_change),(0,_jquery.default)("#id_block_quizchat_users_select").on("click",users_select_change),(0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").on("click",users_select_change),(0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").on("change",users_select_change),(0,_jquery.default)("#block_quizchat_instructor_form").submit(send_msg),(0,_jquery.default)(document).on("click","#permissions_help_icon",help_click),(0,_jquery.default)(document).on("click","#close_help_icon",help_click);let fsaction_link=document.querySelector(".block_quizchat.block_with_controls a.fullscreen_actionmenu_item");fsaction_link&&(fsaction_link.tabIndex="0",fsaction_link.addEventListener("click",fullscreen_click)),(0,_jquery.default)(textinputcontrolname).on("input",text_oninput),(0,_jquery.default)(textinputcontrolname).on("blur",text_onblur),(0,_jquery.default)(textinputcontrolname).on("invalid",text_setvalidmsg),setFormsIfExist();let targetNode=(0,_jquery.default)("#block_quizchat_questions_form"),targetNode_p=(0,_jquery.default)("#block_quizchat_instructor_form"),ul_config={childList:!0,subtree:!0},ul_observer=new MutationObserver(ul_callback),ul_observer_participants=new MutationObserver(ul_callback_p);ul_observer.observe(targetNode[0],ul_config),ul_observer_participants.observe(targetNode_p[0],ul_config),_master2.full_screen_flag||((0,_master.write_sessionStorage)("selected_user_or_question_id","-2"),(0,_master.write_sessionStorage)("grp_flag",!1)),(0,_jquery.default)("#block_quizchat_input_instructor_send").trigger("focus"),(0,_jquery.default)("#btn_msg_me")&&(0,_jquery.default)("#btn_msg_me").on("click",btn_msg_me_click),(0,_jquery.default)("#btn_msg_all")&&(0,_jquery.default)("#btn_msg_all").on("click",btn_msg_grp_click),(0,_jquery.default)("#allmsgs_link")&&(0,_jquery.default)("#allmsgs_link").on("click",allmsgs_link_clicked),_master2.full_screen_flag&&click_private_group_btns()}))}}));

//# sourceMappingURL=instructor.min.js.map