define("block_quizchat/instructor",["exports","core/ajax","jquery","block_quizchat/master","block_quizchat/chars_limit"],(function(_exports,_ajax,_jquery,_master,_chars_limit){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.update_user_select_status_indicators=_exports.is_teacher=_exports.init_instructor=_exports.autofill_users_select=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};let quizchatobj;var msglen,requiredmsg,groups,textinputcontrolname="#block_quizchat_input_instructor_send",groupid=0;let timeoutid,htmlContent_participants,htmlContent_questions,htmlContent_q_select,htmlContent_p_select,noparticipant_flag=!1;var is_teacher=!1;_exports.is_teacher=is_teacher;const send_msg=submit_event=>{if(submit_event.preventDefault(),(0,_chars_limit.handleWhiteSpaceMsg)(textinputcontrolname)){let msg_text_input=document.querySelector(textinputcontrolname);return(0,_chars_limit.resetCharsCount)(msglen),msg_text_input.setCustomValidity(requiredmsg),msg_text_input.reportValidity(),-1}if(0===(0,_jquery.default)('#fitem_id_block_quizchat_users_select .form-autocomplete-selection [role="option"]').length)return(0,_jquery.default)("#fitem_id_block_quizchat_users_select label").css({color:"#f00","font-weight":"600"}),0===(0,_jquery.default)('#fitem_id_block_quizchat_questions_select .form-autocomplete-selection [role="option"]').length?(0,_jquery.default)("#fitem_id_block_quizchat_questions_select label").css({color:"#f00","font-weight":"600"}):(0,_jquery.default)("#fitem_id_block_quizchat_questions_select label").css({color:"#000","font-weight":"normal"}),-1;let receiverid=(0,_jquery.default)('#fitem_id_block_quizchat_users_select span[role="option"]')[0].dataset.value;if(parseInt(receiverid)==_master.quizchat_address_question_group&&(receiverid=0),0===(0,_jquery.default)('#fitem_id_block_quizchat_questions_select .form-autocomplete-selection [role="option"]').length)return(0,_jquery.default)("#fitem_id_block_quizchat_questions_select label").css({color:"#f00","font-weight":"600"}),-1;(0,_jquery.default)("#questions_required").css("display","none");let questionid=(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]')[0].dataset.value,grps_ar=Object.keys(groups).map((key=>({...groups[key]})));groupid=parseInt(receiverid)==_master.quizchat_address_everyone?parseInt((0,_jquery.default)('#fitem_id_block_quizchat_users_select span[role="option"]')[0].dataset.value)==_master.quizchat_address_question_group&&parseInt(questionid)!=_master.quizchat_general_question_id?0:parseInt(grps_ar.find((obj=>"all"===obj.name)).id):0,(0,_jquery.default)("#id_block_quizchat_users_select_label").css({color:"#000","font-weight":"normal"}),(0,_jquery.default)('#fitem_id_block_quizchat_users_select input[type="text"]').css({color:"#000","font-weight":"normal"}),(0,_jquery.default)("#block_quizchat_input_instructor_send").prop("disabled",!0),(0,_jquery.default)("#block_quizchat_button_instructor_send").prop("disabled",!0),(0,_chars_limit.resetCharsCount)(msglen);const calls=[{methodname:"block_quizchat_create_message",args:{quizchatid:quizchatobj.id,receiverid:parseInt(receiverid),groupid:groupid,message:(0,_jquery.default)("#block_quizchat_input_instructor_send").val(),questionattemptid:0,questionid:parseInt(questionid)}}];(0,_ajax.call)(calls)[0].then((data=>((0,_master.reset_poll_timeout)(),(0,_jquery.default)("#block_quizchat_input_instructor_send").val(""),resetMenus(),(0,_jquery.default)("#block_quizchat_input_instructor_send").prop("disabled",!1),(0,_jquery.default)("#block_quizchat_button_instructor_send").prop("disabled",!1),(0,_jquery.default)("#block_quizchat_input_instructor_send").trigger("focus"),data.id))).catch((()=>{(0,_jquery.default)("#block_quizchat_input_instructor_send").prop("disabled",!1),(0,_jquery.default)("#block_quizchat_button_instructor_send").prop("disabled",!1)}))},text_oninput=oninput_event=>{oninput_event.preventDefault(),(0,_chars_limit.checkCharsLength)(msglen,textinputcontrolname),oninput_event.target.setCustomValidity("")},text_onblur=onblur_event=>{onblur_event.preventDefault(),(0,_chars_limit.handleWhiteSpaceMsg)(textinputcontrolname)&&(0,_chars_limit.resetCharsCount)(msglen),onblur_event.target.setCustomValidity("")},get_user_state=userid=>_master.quizchat_users.find((u=>u.id===userid)).state;_exports.autofill_users_select=event=>{event.preventDefault();const[userid,questionid,questiontxt]=event.target.getAttribute("href").slice(1).split("/");(0,_jquery.default)("#id_block_quizchat_enableflag").attr("value",0),resetMenus_click_respond(userid,questionid,questiontxt),update_user_select_status_indicators(),event.target.blur()};const update_user_select_status_indicators=()=>{(0,_jquery.default)('#block_quizchat_instructor_form ul.form-autocomplete-suggestions li[role="option"]').each((function(i,el){let userid=parseInt(el.getAttribute("data-value"));if(isNaN(userid))return;let userstate=get_user_state(userid),status_indicator_el=(0,_jquery.default)("div.statecircle-base-menu",(0,_jquery.default)(el));status_indicator_el.removeClass(),status_indicator_el.addClass("statecircle-base-menu "+userstate),status_indicator_el.attr("title",_master.lang_strings[userstate])}));let chosen_option_span=(0,_jquery.default)('#block_quizchat_instructor_form span[role="option"]');if(0>=chosen_option_span.length)return;let chosen_userid=parseInt(chosen_option_span.attr("data-value")),chosen_user_state=get_user_state(chosen_userid),chosen_status_indicator=(0,_jquery.default)("div.statecircle-base-menu",chosen_option_span);chosen_status_indicator.removeClass(),chosen_status_indicator.addClass("statecircle-base-menu "+chosen_user_state),chosen_status_indicator.attr("title",_master.lang_strings[chosen_user_state])};_exports.update_user_select_status_indicators=update_user_select_status_indicators;const text_setvalidmsg=e=>{e.target.setCustomValidity(requiredmsg)},users_select_change=()=>{0==(0,_jquery.default)("#id_block_quizchat_enableflag").attr("value")&&(0,_jquery.default)("#id_block_quizchat_enableflag").attr("value",1)},questions_select_change=()=>{if(1==(0,_jquery.default)("#id_block_quizchat_enableflag").attr("value")){(0,_jquery.default)("#id_block_quizchat_questions_select_label").css({color:"#000","font-weight":"normal"});let questionid,participantid,group_string=_master.lang_strings.group_txt,everyone_string=_master.lang_strings.everyone,selected_question=document.querySelector('#fitem_id_block_quizchat_questions_select span[role="option"]'),selected_participant=document.querySelector('#fitem_id_block_quizchat_users_select span[role="option"]');if(selected_question)if(questionid=(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]')[0].dataset.value,selected_participant)if(participantid=(0,_jquery.default)('#fitem_id_block_quizchat_users_select span[role="option"]')[0].dataset.value,questionid==String(_master.quizchat_general_question_id))participantid!=String(_master.quizchat_address_everyone)&&(0==(0,_jquery.default)('#block_quizchat_instructor_form li[data-value="'+_master.quizchat_address_everyone+'"]').length?((0,_jquery.default)('#block_quizchat_instructor_form span[aria-hidden="true"]:contains("× ")').trigger("click"),(0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").trigger("click"),checkIfElementExists('#block_quizchat_instructor_form div.participant-name-menu[title="'+everyone_string+'"]')):(0,_jquery.default)('#block_quizchat_instructor_form li[data-value="'+_master.quizchat_address_everyone+'"]').trigger("click"));else{let gname=(0,_jquery.default)('#block_quizchat_questions_form span[role="option"] div.divcontainer-questions').attr("title"),selected_participant_name=(0,_jquery.default)("#block_quizchat_instructor_form div.participant-name-menu").attr("title"),allgrouptxt=group_string+" "+gname;(participantid!=_master.quizchat_address_question_group||selected_participant_name!=allgrouptxt)&&(0==(0,_jquery.default)('#block_quizchat_instructor_form div.participant-name-menu[title="'+allgrouptxt+'"]').length?((0,_jquery.default)('#block_quizchat_instructor_form span[aria-hidden="true"]:contains("× ")').trigger("click"),(0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").trigger("click"),checkIfElementExists('#block_quizchat_instructor_form div.participant-name-menu[title="'+allgrouptxt+'"]')):(0,_jquery.default)('#block_quizchat_instructor_form div.participant-name-menu[title="'+allgrouptxt+'"]').trigger("click"))}else if(questionid==String(_master.quizchat_general_question_id))0==(0,_jquery.default)('#block_quizchat_instructor_form div.participant-name-menu[title="'+everyone_string+'"]').length?((0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").trigger("click"),checkIfElementExists('#block_quizchat_instructor_form div.participant-name-menu[title="'+everyone_string+'"]')):(0,_jquery.default)('#block_quizchat_instructor_form div.participant-name-menu[title="'+everyone_string+'"]').trigger("click");else{let gname=(0,_jquery.default)('#block_quizchat_questions_form span[role="option"] div.divcontainer-questions').attr("title");document.querySelector('#block_quizchat_instructor_form div.participant-name-menu[title="'+group_string+" "+gname+'"]')?(0,_jquery.default)('#block_quizchat_instructor_form div.participant-name-menu[title="'+group_string+" "+gname+'"]').trigger("click"):((0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").trigger("click"),checkIfElementExists('#block_quizchat_instructor_form div.participant-name-menu[title="'+group_string+" "+gname+'"]'))}else selected_participant&&(0,_jquery.default)('#block_quizchat_instructor_form span[aria-hidden="true"]:contains("× ")').trigger("click")}},checkIfElementExists=element=>{element.includes("block_quizchat_instructor_form")&&noparticipant_flag&&users_select_change(),document.querySelector(element)?((0,_jquery.default)(element).trigger("click"),clearTimeout(timeoutid)):timeoutid=setTimeout((()=>{checkIfElementExists(element)}),1e3)},add_divcontainer_after_question_select=()=>{document.querySelector('#fitem_id_block_quizchat_questions_select span[role="option"][data-value="'+_master.quizchat_general_question_id+'"]')?add_divcontainerquestions():setTimeout((()=>{add_divcontainer_after_question_select()}),150)},setFormsIfExist=()=>{let q_form=document.querySelector("#block_quizchat_questions_form ul.form-autocomplete-suggestions"),p_form=document.querySelector("#block_quizchat_instructor_form ul.form-autocomplete-suggestions");q_form&&p_form?(setMenus(),clearTimeout(timeoutid)):timeoutid=setTimeout(setFormsIfExist,1e3)},resetMenus=()=>{(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').each((function(){(0,_jquery.default)(this).find(".divcontainer-questions").replaceWith(htmlContent_questions)})),(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').attr("data-value",_master.quizchat_general_question_id),(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').parent().attr("data-active-value",_master.quizchat_general_question_id),(0,_jquery.default)('#block_quizchat_instructor_form span[role="option"]').each((function(){(0,_jquery.default)(this).find(".statecircle-base-menu").length>0&&(0,_jquery.default)(this).find(".statecircle-base-menu").remove(),(0,_jquery.default)(this).find(".divcontainer").replaceWith(htmlContent_participants)})),(0,_jquery.default)('#block_quizchat_instructor_form span[role="option"]').attr("data-value",_master.quizchat_address_everyone),(0,_jquery.default)('#block_quizchat_instructor_form span[role="option"]').parent().attr("data-active-value",_master.quizchat_address_everyone),(0,_jquery.default)("#id_block_quizchat_questions_select").empty(),(0,_jquery.default)("#id_block_quizchat_questions_select").append(htmlContent_q_select),(0,_jquery.default)("#id_block_quizchat_users_select").empty(),(0,_jquery.default)("#id_block_quizchat_users_select").append(htmlContent_p_select)},resetMenus_click_respond=(pid,qid,qtxt)=>{let questionid,participantid,selected_question=document.querySelector('#fitem_id_block_quizchat_questions_select span[role="option"]'),selected_participant=document.querySelector('#fitem_id_block_quizchat_users_select span[role="option"]');selected_question?(questionid=(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]')[0].dataset.value,selected_participant?(participantid=(0,_jquery.default)('#fitem_id_block_quizchat_users_select span[role="option"]')[0].dataset.value,questionid==String(qid)?participantid!=String(pid)&&(0==(0,_jquery.default)('#block_quizchat_instructor_form li[data-value="'+pid+'"]').length?((0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").trigger("click"),checkIfElementExists('#block_quizchat_instructor_form li[data-value="'+pid+'"]')):(0,_jquery.default)('#block_quizchat_instructor_form li[data-value="'+pid+'"]').trigger("click")):(click_to_respond(qid,qtxt),0==(0,_jquery.default)('#block_quizchat_instructor_form li[data-value="'+pid+'"]').length?(noparticipant_flag=!0,checkIfElementExists('#block_quizchat_instructor_form li[data-value="'+pid+'"]')):(0,_jquery.default)('#block_quizchat_instructor_form li[data-value="'+pid+'"]').trigger("click"))):(questionid==String(qid)||click_to_respond(qid,qtxt),checkIfElementExists('#block_quizchat_instructor_form li[data-value="'+pid+'"]'))):(selected_participant&&(0,_jquery.default)('#block_quizchat_instructor_form span[aria-hidden="true"]:contains("× ")').trigger("click"),click_to_respond(qid,qtxt),checkIfElementExists('#block_quizchat_instructor_form li[data-value="'+pid+'"]')),qid==_master.quizchat_address_everyone&&(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]').attr("data-value")!=qid&&add_divcontainer_after_question_select(),noparticipant_flag=!1},add_divcontainerquestions=()=>{(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]').find(".divcontainer-questions").length>0||(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]').attr("data-value")!=_master.quizchat_general_question_id||(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').each((function(){(0,_jquery.default)(this).contents().last().replaceWith(htmlContent_questions)}))},click_to_respond=(questionid,questiontxt)=>{let select_list_q=(0,_jquery.default)("#block_quizchat_questions_form ul.form-autocomplete-suggestions"),existing_list_item_q=(0,_jquery.default)('li[role="option"][data-value="'+questionid+'"]',select_list_q),listitem_q='<li role="option" data-value="'+questionid+'"></li>',menu_select_q=(0,_jquery.default)("#id_block_quizchat_questions_select"),existing_option_q=(0,_jquery.default)('option[value="'+questionid+'"',menu_select_q),option_q='<option value="'+questionid+'"></option>',divcontainer_q=(0,_jquery.default)('<div class="divcontainer-questions"></div>');click_to_respond_process(select_list_q,existing_list_item_q,listitem_q,menu_select_q,existing_option_q,option_q,divcontainer_q,'<div class="questions-menu" title="'+questiontxt+'">'+questiontxt+"</div>",'#block_quizchat_questions_form ul.form-autocomplete-suggestions li[role="option"][data-value="'+questionid+'"]')},click_to_respond_process=(select_list,existing_list_item,listitem,menu_select,existing_option,option,divcontainer,childdiv,li_to_click)=>{divcontainer.append(childdiv),0===existing_list_item.length&&select_list.append((0,_jquery.default)(listitem).append(divcontainer)),0===existing_option.length&&menu_select.append((0,_jquery.default)(option).append(divcontainer)),(0,_jquery.default)(li_to_click).trigger("click")},setMenus=()=>{htmlContent_participants='<div title="'+_master.lang_strings.everyone+'" class="divcontainer"><div class="participant-name-menu" title="'+_master.lang_strings.everyone+'">'+_master.lang_strings.everyone+"</div></div>",htmlContent_questions='<div title="'+_master.lang_strings.student_question_general+'" class="divcontainer-questions"><div class="questions-menu" title="'+_master.lang_strings.student_question_general+'">'+_master.lang_strings.student_question_general+"</div></div>",htmlContent_q_select=(0,_jquery.default)("#id_block_quizchat_questions_select").children().clone(),htmlContent_p_select=(0,_jquery.default)("#id_block_quizchat_users_select").children().clone(),add_divcontainerquestions(),(0,_jquery.default)('#block_quizchat_instructor_form span[role="option"]').each((function(){(0,_jquery.default)(this).contents().last().replaceWith(htmlContent_participants)})),(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').attr("data-value",_master.quizchat_general_question_id),(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').parent().attr("data-active-value",_master.quizchat_general_question_id),(0,_jquery.default)('#block_quizchat_instructor_form span[role="option"]').attr("data-value",_master.quizchat_address_everyone),(0,_jquery.default)('#block_quizchat_instructor_form span[role="option"]').parent().attr("data-active-value",_master.quizchat_address_everyone)},help_click=()=>{(0,_jquery.default)("#rolepermission_link").on("click",(function(event){event.preventDefault();let hrefValue=(0,_jquery.default)("#rolepermission_link").attr("href"),newwindow=window.open(hrefValue,"rolepermission_link","_blank","toolbar=yes,scrollbars=yes,resizable=yes,width=600,height=600");window.focus&&newwindow.focus()}))},fullscreen_click=event=>{event.preventDefault();let hrefValue=(0,_jquery.default)(".fullscreen_actionmenu_item").attr("href");window.open(hrefValue,"_blank","toolbar=yes,scrollbars=yes,resizable=yes")},ul_callback=mutations=>{for(var mutation of mutations)if("childList"===mutation.type){let attr=(0,_jquery.default)("#block_quizchat_questions_form ul.form-autocomplete-suggestions").attr("aria-hidden");void 0!==attr&&0!=attr||(0,_jquery.default)('#block_quizchat_questions_form ul.form-autocomplete-suggestions li[aria-selected="true"]').attr("aria-selected","false")}},ul_callback_p=mutations=>{for(var mutation of mutations)if("childList"===mutation.type){let attr=(0,_jquery.default)("#block_quizchat_instructor_form ul.form-autocomplete-suggestions").attr("aria-hidden");void 0!==attr&&0!=attr||(0,_jquery.default)('#block_quizchat_instructor_form ul.form-autocomplete-suggestions li[aria-selected="true"]').attr("aria-selected","false")}};_exports.init_instructor=(arg_quizchat,confingsetting_msglen,reqmsg,receivergroups)=>{_exports.is_teacher=is_teacher=!0,("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["block_quizchat/master"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("block_quizchat/master")):Promise.resolve(_systemImportTransformerGlobalIdentifier["block_quizchat/master"])).then((()=>{quizchatobj=arg_quizchat,msglen=confingsetting_msglen,requiredmsg=reqmsg,groups=receivergroups,(0,_jquery.default)("#id_block_quizchat_users_select").change((()=>{(0,_jquery.default)("#block_quizchat_instructor_form label").css({color:"#000","font-weight":"normal"})})),(0,_jquery.default)("#id_block_quizchat_questions_select").on("change",questions_select_change),(0,_jquery.default)("#id_block_quizchat_users_select").on("change",users_select_change),(0,_jquery.default)("#id_block_quizchat_users_select").on("click",users_select_change),(0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").on("click",users_select_change),(0,_jquery.default)("#block_quizchat_instructor_form span.form-autocomplete-downarrow").on("change",users_select_change),(0,_jquery.default)("#block_quizchat_instructor_form").submit(send_msg),(0,_jquery.default)("#permission-link").on("click",help_click),(0,_jquery.default)(".fullscreen_actionmenu_item").on("click",fullscreen_click),(0,_jquery.default)(textinputcontrolname).on("input",text_oninput),(0,_jquery.default)(textinputcontrolname).on("blur",text_onblur),(0,_jquery.default)(textinputcontrolname).on("invalid",text_setvalidmsg),setFormsIfExist();let targetNode=(0,_jquery.default)("#block_quizchat_questions_form"),targetNode_p=(0,_jquery.default)("#block_quizchat_instructor_form"),ul_config={childList:!0,subtree:!0},ul_observer=new MutationObserver(ul_callback),ul_observer_participants=new MutationObserver(ul_callback_p);ul_observer.observe(targetNode[0],ul_config),ul_observer_participants.observe(targetNode_p[0],ul_config),(0,_jquery.default)("#block_quizchat_input_instructor_send").trigger("focus")}))}}));

//# sourceMappingURL=instructor.min.js.map