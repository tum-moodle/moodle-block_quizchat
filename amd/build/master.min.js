define("block_quizchat/master",["exports","core/ajax","core/toast","jquery","block_quizchat/load-mathjax","block_quizchat/instructor"],(function(_exports,_ajax,_toast,_jquery,_loadMathjax,Instructor){var obj;
/**
   * JavaScript library for the block_quizchat plugin.
   *
   * @package
   * @copyright 2023, TUM ProLehre | Medien und Didaktik <moodle@tum.de>
   * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.write_sessionStorage=_exports.update_msg_area=_exports.update_current_msgs_array=_exports.reset_timeoutid_fullscreen=_exports.reset_poll_timeout_fullscreen=_exports.reset_poll_timeout=_exports.quizchatid=_exports.quizchat_users=_exports.quizchat_userid=_exports.quizchat_student_question_id=_exports.quizchat_msg_usr_or_qs=_exports.quizchat_msg_prev=_exports.quizchat_msg_counters=_exports.quizchat_msg=_exports.quizchat_general_question_id=_exports.quizchat_address_question_group=_exports.quizchat_address_m_group=_exports.quizchat_address_instructors=_exports.quizchat_address_everyone=_exports.push_quizchat_users=_exports.poll_timeout_id_fullscreen=_exports.poll_timeout=_exports.poll_messages=_exports.no_drawer=_exports.lang_strings=_exports.isToday=_exports.int_sessionStorage=_exports.init=_exports.getNewMessageCount=_exports.full_screen_flag=_exports.compare_actual_and_prev_data=_exports.calculateUserMessageCounts=_exports.calculateGroupMessageCounts=_exports.allmsgs_id=_exports.allmsgs_count_notf=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj},Instructor=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Instructor);const lang_strings={};_exports.lang_strings=lang_strings;var poll_timeout_id,poll_timeout_id_fullscreen,unnotify_timeout,unnotify_timeout_id,poll_timeout=1e4;_exports.poll_timeout=poll_timeout,_exports.poll_timeout_id_fullscreen=poll_timeout_id_fullscreen;var quizchatid=0;_exports.quizchatid=quizchatid;var quizchat_userid=0;_exports.quizchat_userid=quizchat_userid;let processedDates={};var quizchat_msg={messages:[]};_exports.quizchat_msg=quizchat_msg;var quizchat_msg_prev={messages:[]};_exports.quizchat_msg_prev=quizchat_msg_prev;var quizchat_msg_usr_or_qs={messages:[]};_exports.quizchat_msg_usr_or_qs=quizchat_msg_usr_or_qs;var quizchat_msg_counters={messages:[]};_exports.quizchat_msg_counters=quizchat_msg_counters;var quizchat_users=[];_exports.quizchat_users=quizchat_users;const push_quizchat_users=function(){let users=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],new_users=users.filter((u=>{let i=quizchat_users.findIndex((qc_u=>qc_u.id===u.id));if(-1===i)return u;[quizchat_address_everyone,quizchat_address_instructors].includes(i)||void 0!==u.state&&(quizchat_users[i]=u)}));quizchat_users.push(...new_users)};_exports.push_quizchat_users=push_quizchat_users;const enrolled_states=["abandoned","inprogress","noattempt","finished"];var page_reloaded=!0,getmsgs_mostrecentmsg_id=0,most_recent_msg_id=0;const quizchat_address_everyone=0;_exports.quizchat_address_everyone=quizchat_address_everyone;const quizchat_address_instructors=-1;_exports.quizchat_address_instructors=quizchat_address_instructors;_exports.quizchat_address_question_group=-2;_exports.quizchat_address_m_group=-3;_exports.quizchat_student_question_id=-1;_exports.quizchat_general_question_id=0;_exports.allmsgs_id=-1;var full_screen_flag,no_drawer=!1;_exports.no_drawer=no_drawer,_exports.full_screen_flag=full_screen_flag;_exports.reset_poll_timeout=()=>{clearTimeout(poll_timeout_id),poll_messages(quizchatid)};_exports.reset_poll_timeout_fullscreen=()=>{clearTimeout(poll_timeout_id_fullscreen),poll_messages(quizchatid)};_exports.reset_timeoutid_fullscreen=()=>{_exports.poll_timeout_id_fullscreen=poll_timeout_id_fullscreen=setTimeout(poll_messages,poll_timeout,quizchatid)};const int_sessionStorage=key=>{let val=sessionStorage.getItem("moodle_qc_"+quizchat_userid+"_"+quizchatid+"_"+key);return null===val?0:"true"==val||"false"!=val&&("-1"==val?-1:parseInt(val))};_exports.int_sessionStorage=int_sessionStorage;const write_sessionStorage=(key,val)=>{sessionStorage.setItem("moodle_qc_"+quizchat_userid+"_"+quizchatid+"_"+key,val)};_exports.write_sessionStorage=write_sessionStorage;const poll_messages=quizchatid=>{const followUp=data=>{let user_or_question,usr_or_ques_msgs,usr_or_ques_msgs_str,filteredMessages,msgs_length,user_or_qs_id=int_sessionStorage("selected_user_or_question_id"),group_session=int_sessionStorage("grp_flag");if(most_recent_msg_id=int_sessionStorage(full_screen_flag&&-1!=user_or_qs_id?"latest_msg_id_usr_qs":"latest_msg_id"),getmsgs_mostrecentmsg_id=0,full_screen_flag&&user_or_qs_id>=0&&(user_or_question=group_session?data.groups.find((el=>el.question_id===user_or_qs_id)):data.p_users.find((el=>el.userid===user_or_qs_id)),void 0!==user_or_question?(usr_or_ques_msgs_str=user_or_question.message_ids.replace(/\s/g,""),usr_or_ques_msgs_str=usr_or_ques_msgs_str.split(","),usr_or_ques_msgs=usr_or_ques_msgs_str.map((id=>parseInt(id)))):usr_or_ques_msgs=[]),filteredMessages=full_screen_flag&&user_or_qs_id>=0?usr_or_ques_msgs.length>0?data.messages.filter((msg=>usr_or_ques_msgs.includes(msg.id))):[]:data.messages,msgs_length=filteredMessages.length,msgs_length>0){let total_unread_msg=int_sessionStorage("total_unread_msg"),diff=filteredMessages.filter((msg=>most_recent_msg_id<msg.id)).length;total_unread_msg+=filteredMessages.filter((msg=>most_recent_msg_id<msg.id&&msg.userid!==quizchat_userid)).length,most_recent_msg_id<filteredMessages[msgs_length-1].id||page_reloaded?(full_screen_flag&&-1!=user_or_qs_id?write_sessionStorage("total_unread_msg_usr_qs",0):write_sessionStorage("total_unread_msg",total_unread_msg),_exports.quizchat_msg_prev=quizchat_msg_prev=quizchat_msg,_exports.quizchat_msg=quizchat_msg=data,_exports.quizchat_msg_counters=quizchat_msg_counters=compare_actual_and_prev_data(quizchat_msg_prev,quizchat_msg),full_screen_flag&&user_or_qs_id>=0&&(_exports.quizchat_msg_usr_or_qs=quizchat_msg_usr_or_qs=filteredMessages),page_reloaded?(page_reloaded=!1,update_msg_area(msgs_length)):update_msg_area(diff),update_notification(filteredMessages[msgs_length-1]),write_sessionStorage(full_screen_flag&&-1!=user_or_qs_id?"latest_msg_id_usr_qs":"latest_msg_id",filteredMessages[msgs_length-1].id)):(_exports.quizchat_msg_prev=quizchat_msg_prev=quizchat_msg,_exports.quizchat_msg=quizchat_msg=data,_exports.quizchat_msg_counters=quizchat_msg_counters=compare_actual_and_prev_data(quizchat_msg_prev,quizchat_msg),full_screen_flag&&user_or_qs_id>=0&&(_exports.quizchat_msg_usr_or_qs=quizchat_msg_usr_or_qs=filteredMessages),update_message_headers(),update_sidemenu_status(),update_header_status(),void 0!==(0,_jquery.default)("#conversations_container_private").html()&&(0,Instructor.btn_msg_me_click)(),void 0!==(0,_jquery.default)("#conversations_container_group").html()&&(0,Instructor.btn_msg_grp_click)())}else 0==msgs_length&&(empty_private_group_msgs_count(),_exports.quizchat_msg_prev=quizchat_msg_prev=quizchat_msg,_exports.quizchat_msg=quizchat_msg=data,_exports.quizchat_msg_counters=quizchat_msg_counters=compare_actual_and_prev_data(quizchat_msg_prev,quizchat_msg),full_screen_flag&&user_or_qs_id>=0&&(_exports.quizchat_msg_usr_or_qs=quizchat_msg_usr_or_qs=filteredMessages),update_message_headers(),update_sidemenu_status(),update_header_status(),void 0!==(0,_jquery.default)("#conversations_container_private").html()&&(0,Instructor.btn_msg_me_click)(),void 0!==(0,_jquery.default)("#conversations_container_group").html()&&(0,Instructor.btn_msg_grp_click)())},calls=[{methodname:"block_quizchat_get_messages",args:{quizchatid:quizchatid,most_recent_msg_id:getmsgs_mostrecentmsg_id,langstr_general:lang_strings.student_question_general,langstr_group:lang_strings.group_txt,langstr_attempt:lang_strings.quiz_attempt_txt,langstr_all:lang_strings.everyone,langstr_strftimerecentfull:lang_strings.strftimerecentfull,deleted_langstr:lang_strings.deleted_langstr}}];(0,_ajax.call)(calls)[0].then((data=>{if(0<data.stats.msg_total){data.messages.sort(((a,b)=>a.timestamp>b.timestamp));let userdata=[];const usersMap=new Map;data.messages.forEach((message=>{usersMap.has(message.userid)||usersMap.set(message.userid,{id:message.userid,lastname:message.lastname,firstname:message.firstname,fullname:message.fullname,profileimageurlsmall:message.picture,state:message.state})})),data.messages.forEach((message=>{-2!=message.receiverid?usersMap.has(message.receiverid)||usersMap.set(message.receiverid,{id:message.receiverid,lastname:message.rlastname,firstname:message.rfirstname,fullname:message.rfullname}):usersMap.has(message.receiverid)||usersMap.set(message.receiverid+"/"+message.rfullname,{id:message.receiverid+"/"+message.rfullname,lastname:message.rlastname,firstname:message.rfirstname,fullname:message.rfullname})})),userdata=Array.from(usersMap.values()),0<userdata.length?(push_quizchat_users(userdata),followUp(data)):followUp(data)}else 0>data.stats.msg_total&&(followUp(data),empty_private_group_msgs_count())})),poll_timeout_id=setTimeout(poll_messages,poll_timeout,quizchatid)};_exports.poll_messages=poll_messages;const empty_private_group_msgs_count=()=>{(0,_jquery.default)("#private_msgs_count")&&(0,_jquery.default)("#private_msgs_count").html("0"),(0,_jquery.default)("#group_msgs_count")&&(0,_jquery.default)("#group_msgs_count").html("0")},allmsgs_count_notf=()=>{let key="newmsgscount_all",msgs_count=sessionStorage.getItem("moodle_qc_"+quizchat_userid+"_"+quizchatid+"_"+key);null===msgs_count?(write_sessionStorage(key,"0"),msgs_count=0):msgs_count=int_sessionStorage(key),msgs_count>0?((0,_jquery.default)("#all-messages-unread-count").html(String(msgs_count)),(0,_jquery.default)("#all-messages-unread-count").attr("aria-hidden","false"),(0,_jquery.default)("#all-messages-unread-count-label").removeClass("hidden")):((0,_jquery.default)("#all-messages-unread-count").attr("aria-hidden","true"),(0,_jquery.default)("#all-messages-unread-count-label").addClass("hidden"),(0,_jquery.default)("#all-messages-unread-count").html(""))};_exports.allmsgs_count_notf=allmsgs_count_notf;const getNewMessageCount=(prev,current)=>{const prevMessages=prev?prev.split(",").map(Number):[],currentMessages=current?current.split(",").map(Number):[];return quizchat_msg.messages.filter((msg=>currentMessages.includes(msg.id))).filter((msg=>!prevMessages.includes(msg.id)&&msg.id>int_sessionStorage("latest_msg_id")&&msg.userid!=quizchat_userid)).length};_exports.getNewMessageCount=getNewMessageCount;const calculateUserMessageCounts=(prevUsers,currUsers)=>currUsers.map((currUser=>{const prevUser=prevUsers.find((u=>u.userid===currUser.userid)),new_msgs_count=prevUser?getNewMessageCount(prevUser.message_ids,currUser.message_ids):currUser.message_ids.replace(/\s/g,"").split(",").length,new_conversation=!prevUser||new_msgs_count>0;return{...currUser,new_msgs_count:new_msgs_count,new_conversation:new_conversation}}));_exports.calculateUserMessageCounts=calculateUserMessageCounts;const calculateGroupMessageCounts=(prevGroups,currGroups)=>currGroups.map((currGroup=>{const prevGroup=prevGroups.find((g=>g.question_id===currGroup.question_id)),new_msgs_count=prevGroup?getNewMessageCount(prevGroup.message_ids,currGroup.message_ids):currGroup.message_ids.replace(/\s/g,"").split(",").length,new_conversation=!prevGroup||new_msgs_count>0;return{...currGroup,new_msgs_count:new_msgs_count,new_conversation:new_conversation}}));_exports.calculateGroupMessageCounts=calculateGroupMessageCounts;const compare_actual_and_prev_data=(prevData,currData)=>({p_users:calculateUserMessageCounts(prevData.p_users||currData.p_users,currData.p_users),groups:calculateGroupMessageCounts(prevData.groups||currData.groups,currData.groups)});_exports.compare_actual_and_prev_data=compare_actual_and_prev_data;_exports.update_current_msgs_array=current_msgs=>{current_msgs.length>0&&(_exports.quizchat_msg_usr_or_qs=quizchat_msg_usr_or_qs=current_msgs,most_recent_msg_id=current_msgs[current_msgs.length-1].id,processedDates={})};const update_msg_area=diff=>{let msgs,last_received_msg_id;if(int_sessionStorage("selected_user_or_question_id")>=0?(msgs=quizchat_msg_usr_or_qs,last_received_msg_id=int_sessionStorage("latest_msg_id_usr_qs")):(!full_screen_flag||most_recent_msg_id>0)&&(msgs=quizchat_msg.messages,last_received_msg_id=most_recent_msg_id),void 0!==msgs){let new_msg_user,new_msg_receiver,card_flavor,new_msg_el,msg_time,new_msg=msgs.slice(msgs.length-diff),profimg="";if(0<diff){for(let i=0;i<new_msg.length;i++){new_msg_user=quizchat_users.find((u=>u.id==new_msg[i].userid)),new_msg_receiver=-2==new_msg[i].receiverid?quizchat_users.find((u=>u.id==new_msg[i].receiverid+"/"+new_msg[i].rfullname)):-3==new_msg[i].receiverid?new_msg[i].rfullname:quizchat_users.find((u=>u.id==new_msg[i].receiverid)),card_flavor=new_msg[i].userid===quizchat_userid?"bg-secondary":"bg-light border border-secondary"+(last_received_msg_id<new_msg[i].id?" font-weight-bolder":""),new_msg_el=(0,_jquery.default)('<div class="card block_quizchat_msg_el '+card_flavor+' mb-1" data-msg-id="'+new_msg[i].id+'"></div>'),msg_time=new Date(1e3*new_msg[i].timestamp),profimg='<div class="imgcontainer"><img class="rounded profileimg" src="'+new_msg_user.profileimageurlsmall+'" alt="'+new_msg_user.fullname+'" title="'+new_msg_user.fullname+'"></img></div>';let displayDate=isToday(new_msg[i].timestamp)?lang_strings.today:new_msg[i].date_part;if(!processedDates[displayDate]){let dateDiv=(0,_jquery.default)('<div class="line-with-text" id="'+displayDate+'"><hr><span>'+displayDate+"</span><hr></div>");(0,_jquery.default)("#block_quizchat_messages > .block_quizchat_msg_area_body").append(dateDiv),processedDates[displayDate]=displayDate}(0,_jquery.default)(new_msg_el).append((0,_jquery.default)('<div class="card-header"></div>').append((0,_jquery.default)('<div class="msg-header p-0"></div>').append((0,_jquery.default)('<div class="block_quizchat_user_icon">').append(profimg),(0,_jquery.default)('<div class="text-right tofrom from">'+lang_strings.from+":</div>"),(0,_jquery.default)('<div class="fullname text-truncate" data-address-type="from" title="'+new_msg_user.fullname+'">'+new_msg_user.fullname+"</div>"),(0,_jquery.default)('<div class="timestamp text-right">'+msg_time.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})+"</div>"),(0,_jquery.default)('<div class="text-right tofrom to">'+lang_strings.to+":</div>"),(0,_jquery.default)('<div class="fullname text-truncate" data-address-type="to" title="'+(-3==new_msg[i].receiverid?new_msg_receiver:new_msg_receiver.fullname)+'">'+(-3==new_msg[i].receiverid?new_msg_receiver:new_msg_receiver.fullname)+"</div>"))),(0,_jquery.default)('<div class="card-body"><div class="question-info"><b>'+lang_strings.student_question_select+" "+new_msg[i].questiontxt+new_msg[i].quizattempt+'</b></div><div class="msg-txt">'+new_msg[i].message+"</div></div>")),(0,_jquery.default)("#private_msgs_count")&&(0,_jquery.default)("#private_msgs_count").html(quizchat_msg.stats.private),(0,_jquery.default)("#group_msgs_count")&&(0,_jquery.default)("#group_msgs_count").html(quizchat_msg.stats.group),(0,_jquery.default)("#block_quizchat_messages > .block_quizchat_msg_area_body").append(new_msg_el),i==new_msg.length-1&&((0,_loadMathjax.queue_typeset)("card-body"),(0,_jquery.default)(".block_quizchat_msg_area_body").scrollTop((0,_jquery.default)(".block_quizchat_msg_area_body")[0].scrollHeight))}void 0!==(0,_jquery.default)("#conversations_container_private").html()&&(0,Instructor.btn_msg_me_click)(),void 0!==(0,_jquery.default)("#conversations_container_group").html()&&(0,Instructor.btn_msg_grp_click)(),update_unnotify_timeout(),update_message_headers(),update_sidemenu_status(),update_header_status(),(0,Instructor.update_user_select_status_indicators)()}}};_exports.update_msg_area=update_msg_area;const update_notification=msg=>{let total_unread_msg=int_sessionStorage("total_unread_msg");if(quizchat_userid!==msg.userid&&0<total_unread_msg){let diff_string=total_unread_msg+" "+(1<total_unread_msg||0==total_unread_msg?lang_strings.notification_new_msg_plural:lang_strings.notification_new_msg_singular);(0,_jquery.default)(".toast").remove(),(0,_toast.add)(msg.message,{type:"info",title:diff_string,subtitle:lang_strings.from+": "+quizchat_users.find((u=>u.id===msg.userid)).fullname,closeButton:!0,autohide:!1,delay:1e4}).then((()=>{no_drawer||full_screen_flag||update_toast_style((0,_jquery.default)("#theme_boost-drawers-blocks")[0]),(0,_loadMathjax.queue_typeset)("toast-wrapper")})),(0,_jquery.default)("#block_quizchat_messages > .block_quizchat_msg_area_header").text(diff_string),full_screen_flag||((0,_jquery.default)("#new_msg_icon").remove(),(0,_jquery.default)(".drawer-toggler.drawer-right-toggle").prepend((0,_jquery.default)('<img src="'+M.cfg.wwwroot+'/blocks/quizchat/img/icon-new-message-30.png"id="new_msg_icon" alt="'+diff_string+'" title="'+diff_string+'"></img>')))}},isToday=date=>{let today=new Date,checkDate=new Date(1e3*date);return today.setHours(0,0,0,0),checkDate.setHours(0,0,0,0),today.getTime()===checkDate.getTime()};_exports.isToday=isToday;const unnotify=()=>{if(write_sessionStorage("total_unread_msg",0),(0,_jquery.default)(".toast").remove(),(0,_jquery.default)(".block_quizchat_msg_el.font-weight-bolder").removeClass("font-weight-bolder"),full_screen_flag){allmsgs_count_notf();let header_question_or_user_id,side_counter_span_id,header_is_allmsgs=!1;if(void 0!==(0,_jquery.default)("#conv-header").data("group-id")?(header_question_or_user_id=parseInt((0,_jquery.default)("#conv-header").data("group-id")),-1==header_question_or_user_id&&(header_is_allmsgs=!0),side_counter_span_id="#unread-count-question-"+header_question_or_user_id):void 0!==(0,_jquery.default)("#conv-header").data("user-id")&&(header_question_or_user_id=parseInt((0,_jquery.default)("#conv-header").data("user-id")),side_counter_span_id="#unread-count-user-"+header_question_or_user_id),header_is_allmsgs)(0,_jquery.default)('span[id^="unread-count-"]').attr("aria-hidden","true"),(0,_jquery.default)('span[id^="unread-count-"]').parent("span").addClass("hidden"),(0,_jquery.default)('span[id^="unread-count-"]').html("");else{(0,_jquery.default)(side_counter_span_id).attr("aria-hidden","true"),(0,_jquery.default)(side_counter_span_id).parent("span").addClass("hidden"),(0,_jquery.default)(side_counter_span_id).html("");let session_msgs_count_all=0,key_all="newmsgscount_all";Object.keys(sessionStorage).forEach((sessionkey=>{(sessionkey.includes("newmsgscount_questionid_")||sessionkey.includes("newmsgscount_userid_"))&&(session_msgs_count_all+=parseInt(sessionStorage.getItem(sessionkey)))})),write_sessionStorage(key_all,String(session_msgs_count_all)),allmsgs_count_notf()}}else(0,_jquery.default)("#block_quizchat_messages > .block_quizchat_msg_area_header").text("0 "+lang_strings.notification_new_msg_plural);(0,_jquery.default)("#new_msg_icon").remove()},update_toast_style=drawer=>{let button=document.querySelector('[data-toggler="drawers"][data-target="theme_boost-drawers-blocks"][data-action="toggle"]'),offset=0;no_drawer||(offset=drawer.classList.contains("show")?drawer.offsetWidth+15:button.parentNode.offsetWidth+15),(0,_jquery.default)(".toast").removeClass("mx-auto"),(0,_jquery.default)(".toast").css({position:"absolute",right:offset,width:"350","max-width":"350"}),(0,_jquery.default)(".toast .toast-subtitle.ml-auto.small").css({"white-space":"nowrap","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","text-align":"right"}),(0,_jquery.default)(".toast .toast-message").css({"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}),(0,_jquery.default)(".toast-wrapper").removeClass(["mx-auto","fixed-top"]),(0,_jquery.default)(".toast-wrapper").css({position:"absolute",width:"350","max-width":"350",right:"0"})},update_message_headers=()=>{(0,_jquery.default)(".block_quizchat_msg_el").each((function(i,el){let msg;msg=1==quizchat_msg.messages.length?quizchat_msg.messages[0]:quizchat_msg.messages.find((m=>m.id===parseInt(el.getAttribute("data-msg-id"))));let msg_user=quizchat_users.find((u=>u.id===msg.userid));if(msg.userid!==quizchat_userid){let fullname_th=(0,_jquery.default)('div.fullname[data-address-type="from"]',(0,_jquery.default)(el));if(fullname_th.empty(),enrolled_states.includes(msg_user.state))if(fullname_th.removeClass("fullname_suspended"),Instructor.is_teacher){let questiontxt=(0,_jquery.default)(msg.questiontxt).text();""==questiontxt&&(questiontxt=msg.questiontxt),fullname_th.html(((userid,fullname,questionid,questiontxt)=>{let respond_link=document.createElement("a");return respond_link.setAttribute("href","#"+userid+"/"+questionid+"/"+questiontxt),respond_link.setAttribute("id","click_to_respond_link_"+userid+"_"+questionid+"_"+questiontxt),respond_link.append(document.createTextNode(fullname)),respond_link.addEventListener("click",Instructor.autofill_users_select),respond_link})(msg.userid,msg_user.fullname,msg.questionid,questiontxt))}else fullname_th.text(msg_user.fullname);else["suspended","deleted","unenrolled"].includes(msg_user.state)&&fullname_th.addClass("fullname_suspended"),fullname_th.text(msg_user.fullname)}if(Instructor.is_teacher){(0,_jquery.default)("div.imgcontainer div.statecircle-base",(0,_jquery.default)(el)).length<=0&&(0,_jquery.default)("div.imgcontainer",(0,_jquery.default)(el)).append('<div class="statecircle-base"></div>');let state_indicator=(0,_jquery.default)("div.imgcontainer div.statecircle-base",(0,_jquery.default)(el));state_indicator.attr("title",lang_strings[msg_user.state]),state_indicator.removeClass(),state_indicator.addClass("statecircle-base "+msg_user.state)}}))},update_sidemenu_status=()=>{(0,_jquery.default)(".contact-status-sidemenu").each((function(i,el){let user;if(user=1==quizchat_msg.p_users.length?quizchat_msg.p_users[0]:quizchat_msg.p_users.find((u=>u.userid===parseInt(el.getAttribute("data-user-id")))),Instructor.is_teacher){let state_indicator=(0,_jquery.default)("div.statecircle-base",(0,_jquery.default)(el));state_indicator.attr("title",lang_strings[user.state]),state_indicator.removeClass(),state_indicator.addClass("statecircle-base "+user.state)}}))},update_header_status=()=>{let state_indicator=(0,_jquery.default)("#header-state"),written_state_indicator=(0,_jquery.default)("#written-header-state");if(Instructor.is_teacher&&state_indicator.length&&full_screen_flag&&written_state_indicator.length){let user=quizchat_msg.p_users.find((u=>u.userid===parseInt(state_indicator.attr("data-user-id"))));void 0===user&&(user=quizchat_users.find((u=>u.id===parseInt(state_indicator.attr("data-user-id"))))),state_indicator.attr("title",lang_strings[user.state]),state_indicator.removeClass(),state_indicator.addClass("statecircle-base "+user.state),written_state_indicator.html(lang_strings[user.state])}},drawer_mutation_callback=mutation=>{(0,_jquery.default)(".block_quizchat_msg_area_body").scrollTop((0,_jquery.default)(".block_quizchat_msg_area_body")[0].scrollHeight),update_unnotify_timeout(),update_toast_style(mutation[0].target)},update_unnotify_timeout=()=>{full_screen_flag||no_drawer||(0,_jquery.default)("#theme_boost-drawers-blocks")[0].classList.contains("show")?unnotify_timeout_id=setTimeout(unnotify,unnotify_timeout):clearTimeout(unnotify_timeout_id)};_exports.init=(arg_quizchat,arg_userid,setting_poll_timeout,setting_unnotify_timeout,no_drawer_flag,fullscreen_flag)=>{let langstr_json=document.getElementById("block_quizchat_langstr").innerHTML,langstr_import=JSON.parse(langstr_json);for(const[key,val]of Object.entries(langstr_import))lang_strings[key]=val;_exports.no_drawer=no_drawer=no_drawer_flag,_exports.full_screen_flag=full_screen_flag=fullscreen_flag,_exports.quizchat_userid=quizchat_userid=arg_userid,function(){let users=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];_exports.quizchat_users=quizchat_users=[{id:quizchat_address_everyone,lastname:lang_strings.everyone,firstname:"("+lang_strings.group+")",fullname:lang_strings.everyone,state:"finished"},{id:quizchat_address_instructors,lastname:lang_strings.instructors,firstname:"("+lang_strings.group+")",fullname:lang_strings.instructors,state:"finished"}],Array.isArray(users)&&0<users.length&&quizchat_users.push(...users.filter((u=>{if(![0,1].includes(u.id))return u})))}();const drawer_blocks=(0,_jquery.default)("#theme_boost-drawers-blocks"),obs_config={attributes:!0,attributeFilter:["class"]},drawer_blocks_observer=new MutationObserver(drawer_mutation_callback);_exports.poll_timeout=poll_timeout=1e3*setting_poll_timeout,unnotify_timeout=1e3*setting_unnotify_timeout,no_drawer||full_screen_flag||drawer_blocks_observer.observe(drawer_blocks[0],obs_config),_exports.quizchatid=quizchatid=arg_quizchat.id,poll_messages(quizchatid)}}));

//# sourceMappingURL=master.min.js.map