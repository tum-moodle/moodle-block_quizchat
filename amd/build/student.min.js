define("block_quizchat/student",["exports","core/ajax","jquery","block_quizchat/master","block_quizchat/chars_limit"],(function(_exports,_ajax,_jquery,_master,_chars_limit){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init_student=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};let quizchatobj;var msglen,requiredmsg,groups;let htmlContent_questions,htmlContent_q_select,timeoutid;var textinputcontrolname="#block_quizchat_input_student_send";const send_msg_to_instructor=submit_event=>{if(submit_event.preventDefault(),(0,_chars_limit.handleWhiteSpaceMsg)(textinputcontrolname)){let msg_text_input=document.querySelector(textinputcontrolname);return(0,_chars_limit.resetCharsCount)(msglen),msg_text_input.setCustomValidity(requiredmsg),msg_text_input.reportValidity(),-1}if(0===(0,_jquery.default)('#fitem_id_block_quizchat_questions_select .form-autocomplete-selection [role="option"]').length)return(0,_jquery.default)("#fitem_id_block_quizchat_questions_select label").css({color:"#f00","font-weight":"600"}),-1;(0,_jquery.default)("#questions_required").css("display","none");let questionattemptid=0;questionattemptid=""===(0,_jquery.default)("#fitem_id_block_quizchat_questions_select option:selected")[0].value?(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]')[0].dataset.value:(0,_jquery.default)("#id_block_quizchat_questions_select").val(),(0,_jquery.default)("#id_block_quizchat_questions_select_label").css({color:"#000","font-weight":"normal"}),(0,_jquery.default)("#block_quizchat_input_student_send").prop("disabled",!0),(0,_jquery.default)("#block_quizchat_button_student_send").prop("disabled",!0),(0,_chars_limit.resetCharsCount)(msglen);let grps_ar=Object.keys(groups).map((key=>({...groups[key]}))),groupid=parseInt(grps_ar.find((obj=>"teachers"===obj.name)).id);const calls=[{methodname:"block_quizchat_create_message",args:{quizchatid:quizchatobj.id,receiverid:0,groupid:groupid,message:(0,_jquery.default)("#block_quizchat_input_student_send").val(),questionattemptid:questionattemptid,questionid:0}}];(0,_ajax.call)(calls)[0].then((data=>((0,_master.reset_poll_timeout)(),(0,_jquery.default)("#block_quizchat_input_student_send").val(""),resetMenu(),(0,_jquery.default)("#block_quizchat_input_student_send").prop("disabled",!1),(0,_jquery.default)("#block_quizchat_button_student_send").prop("disabled",!1),data.id))).catch((()=>{(0,_jquery.default)("#block_quizchat_input_student_send").prop("disabled",!1),(0,_jquery.default)("#block_quizchat_button_student_send").prop("disabled",!1)}))},text_oninput=oninput_event=>{oninput_event.preventDefault(),oninput_event.target.setCustomValidity(""),(0,_chars_limit.checkCharsLength)(msglen,textinputcontrolname)},text_onblur=onblur_event=>{onblur_event.preventDefault(),(0,_chars_limit.handleWhiteSpaceMsg)(textinputcontrolname)&&(0,_chars_limit.resetCharsCount)(msglen),onblur_event.target.setCustomValidity("")},text_setvalidmsg=e=>{e.target.setCustomValidity(requiredmsg)},add_divcontainerquestions=()=>{(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]').find(".divcontainer-questions").length>0||(0,_jquery.default)('#fitem_id_block_quizchat_questions_select span[role="option"]').attr("data-value")!=_master.quizchat_general_question_id||(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').each((function(){(0,_jquery.default)(this).contents().last().replaceWith(htmlContent_questions)}))},setFormIfExist=()=>{document.querySelector("#block_quizchat_questions_form ul.form-autocomplete-suggestions")?(htmlContent_questions='<div title="'+_master.lang_strings.student_question_general+'" class="divcontainer-questions"><div class="questions-menu" title="'+_master.lang_strings.student_question_general+'">'+_master.lang_strings.student_question_general+"</div></div>",htmlContent_q_select=(0,_jquery.default)("#id_block_quizchat_questions_select").children().clone(),add_divcontainerquestions(),(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').attr("data-value",_master.quizchat_general_question_id),(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').parent().attr("data-active-value",_master.quizchat_general_question_id),clearTimeout(timeoutid)):timeoutid=setTimeout(setFormIfExist,1e3)},resetMenu=()=>{(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').each((function(){(0,_jquery.default)(this).find(".divcontainer-questions").replaceWith(htmlContent_questions)})),(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').attr("data-value",_master.quizchat_general_question_id),(0,_jquery.default)('#block_quizchat_questions_form span[role="option"]').parent().attr("data-active-value",_master.quizchat_general_question_id),(0,_jquery.default)("#id_block_quizchat_questions_select").empty(),(0,_jquery.default)("#id_block_quizchat_questions_select").append(htmlContent_q_select)},ul_callback=mutations=>{for(var mutation of mutations)if("childList"===mutation.type){let attr=(0,_jquery.default)("#block_quizchat_questions_form ul.form-autocomplete-suggestions").attr("aria-hidden");void 0!==attr&&0!=attr||(0,_jquery.default)('#block_quizchat_questions_form ul.form-autocomplete-suggestions li[aria-selected="true"]').attr("aria-selected","false")}};_exports.init_student=(arg_quizchat,confingsetting_msglen,reqmsg,receivergroups)=>{("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["block_quizchat/master"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("block_quizchat/master")):Promise.resolve(_systemImportTransformerGlobalIdentifier["block_quizchat/master"])).then((()=>{quizchatobj=arg_quizchat,msglen=confingsetting_msglen,requiredmsg=reqmsg,groups=receivergroups,(0,_jquery.default)("#block_quizchat_student_send").submit(send_msg_to_instructor),(0,_jquery.default)("#id_block_quizchat_questions_select").change((()=>{(0,_jquery.default)("#id_block_quizchat_questions_select_label").css({color:"#000","font-weight":"normal"})})),(0,_jquery.default)(textinputcontrolname).on("input",text_oninput),(0,_jquery.default)(textinputcontrolname).on("blur",text_onblur),(0,_jquery.default)(textinputcontrolname).on("invalid",text_setvalidmsg),setFormIfExist(),(0,_master.write_sessionStorage)("selected_user_or_question_id","-2");let targetnode=(0,_jquery.default)("#block_quizchat_questions_form");if(void 0!==targetnode[0]){let ul_config={childList:!0,subtree:!0};new MutationObserver(ul_callback).observe(targetnode[0],ul_config)}}))}}));

//# sourceMappingURL=student.min.js.map